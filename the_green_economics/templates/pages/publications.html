{% extends "base.html" %}

{% block content %}

<div class="max-w-7xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
  <h1 class="text-4xl md:text-6xl font-serif font-bold text-center text-white mb-12 tracking-tight">
    Publicaciones recientes
  </h1>
  <div class="mb-8 flex justify-center">
    <input
      type="text"
      id="searchInput"
      placeholder="Buscar publicaciones..."
      class="w-full max-w-md px-4 py-2 rounded-lg shadow-md border border-white/20 bg-white/10 text-white placeholder-gray-300 focus:outline-none focus:ring-2 focus:ring-green-400 focus:bg-white/20 transition-all duration-300"
      oninput="filtrarPublicaciones()"
    >
  </div>

    <!-- Contenedor de columnas -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <div id="left-column" class="space-y-6"></div>
        <div id="right-column" class="space-y-6"></div>
    </div>

    <!-- Paginación -->
    <div class="mt-8 flex justify-center space-x-2">
        <button onclick="cambiarPagina(-1)"
               class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors pagination-btn">
            &laquo; Anteriores
        </button>

        <span class="px-4 py-2 bg-green-600 text-white rounded-md" id="current-page">1</span>

        <button onclick="cambiarPagina(1)"
               class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md transition-colors pagination-btn">
            Siguientes &raquo;
        </button>
    </div>
</div>

<!-- Modal -->
<div id="modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
    <div class="bg-white p-6 rounded-lg shadow-lg w-full max-w-2xl mx-4 relative">
        <div class="flex justify-between items-center mb-4">
            <h3 id="modal-title" class="text-2xl font-bold text-gray-800"></h3>
            <button onclick="closeModal()" class="text-gray-500 hover:text-gray-700 text-3xl">&times;</button>
        </div>
        <div class="mb-4">
            <span id="modal-date" class="text-sm text-gray-500"></span>
        </div>
        <p id="modal-content" class="text-gray-600 mb-6 whitespace-pre-line"></p>
        <div class="flex justify-between items-center">
            <button onclick="prevPublication()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md">← Anterior</button>
            <button class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-md">Descargar</button>
            <button onclick="nextPublication()" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md">Siguiente →</button>
        </div>
    </div>
</div>
{% endblock %}

{% block inline_javascript %}
<script>
// Función para truncar texto manteniendo palabras completas
function truncateText(text, maxLength) {
    if (text.length <= maxLength) return text;
    let truncated = text.substr(0, maxLength);
    truncated = truncated.substr(0, Math.min(truncated.length, truncated.lastIndexOf(" ")));
    return truncated + '...';
}

// Datos de demostración con contenido extenso
const demoPublications = Array.from({length: 20}, (_, i) => ({
    id: i + 1,
    title: `Publicación ${i + 1}`,
    date: new Date(2024, 0, 20 - i).toLocaleDateString('es-ES'),
    content: `Contenido completo de la publicación ${i + 1}. Lorem ipsum dolor sit amet, consectetur adipiscing elit.
Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud
exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit
in voluptate velit esse cillum dolore eu fugiat nulla pariatur. ${i % 2 === 0 ? 'Texto adicional para demostrar el truncamiento efectivo. ' : ''}`
})).reverse();

let currentPage = 1;
const publicationsPerPage = 8;

function actualizarColumnas() {
    const startIndex = (currentPage - 1) * publicationsPerPage;
    const publicacionesPagina = demoPublications.slice(startIndex, startIndex + publicationsPerPage);

    const mitad = Math.ceil(publicacionesPagina.length / 2);
    const columnaIzq = publicacionesPagina.slice(0, mitad);
    const columnaDer = publicacionesPagina.slice(mitad);

    document.getElementById('left-column').innerHTML = generarColumnHTML(columnaIzq);
    document.getElementById('right-column').innerHTML = generarColumnHTML(columnaDer);
    document.getElementById('current-page').textContent = currentPage;
}

function generarColumnHTML(publicaciones) {
  return publicaciones.map(publicacion => {
      const index = demoPublications.indexOf(publicacion);
      return `
      <div class="bg-white/10 backdrop-blur-sm rounded-lg shadow-lg p-6 hover:bg-white/20 transition-all duration-300 mb-6 border border-white/10 hover:border-white/20">
          <div class="flex justify-between items-start mb-4">
              <div>
                  <h2 class="text-2xl font-semibold text-white hover:text-white">
                      ${publicacion.title}
                  </h2>
                  <p class="text-sm text-gray-300 mt-1">
                      Publicado el: ${publicacion.date}
                  </p>
              </div>
              <button class="text-gray-300 hover:text-gray-100 transition-colors">
                  <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                  </svg>
              </button>
          </div>

          <div class="text-gray-300 mb-4">
              ${truncateText(publicacion.content, 100)}
          </div>

          <div class="flex justify-between items-center border-t border-white/20 pt-4">
              <a href="#" class="text-green-200/80 hover:text-green-100 flex items-center">
                  <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                  </svg>
                  Descargar
              </a>
              <button onclick="openModal(${index})"
                      class="px-4 py-2 bg-white/10 hover:bg-white/20 text-white rounded-md transition-all duration-300 border border-white/10 hover:border-white/20">
                  Ver más
              </button>
          </div>
      </div>
      `;
  }).join('');
}

function cambiarPagina(delta) {
    const newPage = currentPage + delta;
    const maxPage = Math.ceil(demoPublications.length / publicationsPerPage);

    if (newPage > 0 && newPage <= maxPage) {
        currentPage = newPage;
        actualizarColumnas();
    }
}

// Funcionalidad del Modal
let currentPublication = 0;

function openModal(index) {
    currentPublication = index;
    document.getElementById("modal-title").textContent = demoPublications[index].title;
    document.getElementById("modal-date").textContent = `Publicado el: ${demoPublications[index].date}`;
    document.getElementById("modal-content").textContent = demoPublications[index].content;
    document.getElementById("modal").classList.remove("hidden");
    document.body.classList.add("overflow-hidden");
}

function closeModal() {
    document.getElementById("modal").classList.add("hidden");
    document.body.classList.remove("overflow-hidden");
}

function prevPublication() {
    if (currentPublication > 0) {
        currentPublication--;
        openModal(currentPublication);
    }
}

function nextPublication() {
    if (currentPublication < demoPublications.length - 1) {
        currentPublication++;
        openModal(currentPublication);
    }
}

// Event Listeners
document.getElementById('modal').addEventListener('click', function(e) {
    if (e.target === this) closeModal();
});

document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') closeModal();
});

// Inicialización
actualizarColumnas();
function filtrarPublicaciones() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const filtradas = demoPublications.filter(pub =>
      pub.title.toLowerCase().includes(query) ||
      pub.content.toLowerCase().includes(query)
  );

  const startIndex = 0;
  const publicacionesPagina = filtradas.slice(startIndex, publicationsPerPage);
  const mitad = Math.ceil(publicacionesPagina.length / 2);
  const columnaIzq = publicacionesPagina.slice(0, mitad);
  const columnaDer = publicacionesPagina.slice(mitad);

  document.getElementById('left-column').innerHTML = generarColumnHTML(columnaIzq);
  document.getElementById('right-column').innerHTML = generarColumnHTML(columnaDer);
  document.getElementById('current-page').textContent = "1";
  currentPage = 1;
}
</script>
{% endblock %}
